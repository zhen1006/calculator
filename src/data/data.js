

// 基礎配置常數
const GAME_CONSTANTS = {
  EMPTY_TIER: [[], [], [], []], // 空境界模板
  MAX_PROCESS: 19,             // 最大進度值
  EMPTY_VALUE: 0               // 空值
};

// 境界配置
const CULTIVATION_TIERS = [
  { id: 0, name: "築基" },
  { id: 1, name: "結丹" },
  { id: 2, name: "元嬰" },
  { id: 3, name: "化神" },
  { id: 4, name: "反虛" },
  { id: 5, name: "合體" },
  { id: 6, name: "大乘" },
  { id: 7, name: "渡劫" },
  { id: 8, name: "真仙" },
  { id: 9, name: "金仙" }
];

// 修煉階段配置
const CULTIVATION_LEVELS = [
  { id: 0, name: "前期" },
  { id: 1, name: "中期" },
  { id: 2, name: "後期" },
  { id: 3, name: "特殊" } // 特殊階段
];

// 修煉進度配置
const CULTIVATION_PROCESSES = [
  { id: 0, name: "主修" },
  { id: 1, name: "輔修" },
  { id: 2, name: "三修" }
];

// 經驗值配置 - 按境界組織
const EXPERIENCE_DATA = [
  // 築基期
  {
    tier: 0,
    levels: [
      [12376, 15624],                          // 前期
      [15708, 19873, 23919],                   // 中期
      [36180, 45426, 55074, 64320],            // 後期
      []                                       // 特殊
    ]
  },
  // 結丹期
  {
    tier: 1,
    levels: [
      [39438, 49517, 60033, 70112],
      [60915, 77190, 93000, 108810, 125085],
      [158500, 199301, 241672, 280905, 324845, 364077],
      []
    ]
  },
  // 元嬰期
  {
    tier: 2,
    levels: [
      [183679, 230962, 280065, 325529, 376450, 421915],
      [308712, 389749, 470786, 551823, 632859, 710038, 794933],
      [719563, 918827, 1095950, 1295213, 1472337, 1671600, 1848723, 2047987],
      []
    ]
  },
  // 化神期
  {
    tier: 3,
    levels: [
      [801210, 1023083, 1220304, 1442177, 1639398, 1861271, 2058492, 2280365],
      [1412392, 1804723, 2170898, 2537074, 2903249, 3269425, 3635601, 4027931, 4394107],
      [1483013, 1853766, 2286312, 2595272, 3027818, 3460363, 3769324, 4201870, 4572623, 4943376, 5252337, 5623090, 5932051, 6241012, 6549973],
      [],
    ]
  },
    // 返虛期
  {
    tier: 4,
    levels: [
      [1020222, 1292280, 1496324, 1836398, 2040442, 2380515, 2584560, 2856619, 3128678, 3400737, 3604781, 3808825, 4080884, 4216914, 4488973, 4761031, 4897061, 5169120, 5373164, 5577208,],
      [2131409, 2699785, 3126066, 3836536, 4262817, 4973288, 5399569, 5967944, 6536321, 7104696, 7530977, 7957260, 8525635, 8809823, 9378199, 9946574, 10230762, 10799138, 11225420, 11651701],
      [4615726, 5846585, 6769731, 8308306, 9231451, 10770025, 11693172, 12924031, 14154891, 15385751, 16308897, 17232041, 18462902, 19078331, 20309192, 21540052, 22155482, 23386342, 24309487, 25232632],
      []
    ]
  },
    // 合體期
  {
    tier: 5,
    levels: [
      [2802204, 3549458, 4109898, 5043967, 5604407, 6538475, 7098915, 7846170, 8593424, 9340679, 9901119, 10461560, 11208814, 11582441, 12329696, 13076950, 13450577, 14197831, 14758272, 15318712],
      [3959269, 5015074, 5806927, 7126683, 7918537, 9238293, 10030147, 11085952, 12141757, 13197562, 13989415, 14781270, 15837074, 16364976, 17420782, 18476587, 19004489, 20060294, 20852147, 21644001],
      [4566759, 5784560, 6697912, 8220165, 9133517, 10655769, 11569121, 12786923, 14004725, 15222528, 16135879, 17049231, 18267033, 18875934, 20093737, 21311538, 21920440, 23138242, 24051593, 24964945],
      []
    ]
  },
    // 大乘期
  {
    tier: 6,
    levels: [
      [7047835, 8927256, 10336824, 12686101, 14095669, 16444946, 17854513, 19733936, 21613358, 23492780, 24902348, 26311914, 28191337, 29131048, 31010470, 32889893, 33829604, 35709026, 37118593, 38528160],
      [10361621, 13124720, 15197044, 18650918, 20723242, 24177115, 26249440, 29012538, 31775638, 34538736, 36611061, 38683384, 41446484, 42828033, 45591132, 48354231, 49735780, 52498879, 54571204, 56643527],
      [13731909, 17393750, 20140132, 24717435, 27463816, 32041119, 34787501, 38449343, 42111185, 45773027, 48519409, 51265790, 54927633, 56758553, 60420396, 64082238, 65913160, 69575001, 72321383, 75067764],
      []
    ]
  },
    // 渡劫期
  {
    tier: 7,
    levels: [
      [16786018, 21262289, 24619493, 30214832, 33572035, 39167375, 42524578, 47000849, 51477121, 55953392, 59310596, 62667799, 67144071, 69382206, 73858478, 78334749, 80572885, 85049156, 88406360, 91763563],
      [21455764, 27177300, 31468452, 27177300, 42911526, 50063448, 54354600, 60076137, 65797673, 71519211, 75810363, 80101516, 85823053, 88683821, 94405358, 100126894, 102987663, 108709201, 113000352, 117291505],
      [26926091, 34106381, 39491600, 48466963, 53852181, 62827545, 68212762, 75393054, 82573344, 89753635, 95138854, 105240711, 107704362, 111294508, 118474798, 120919628, 129245235, 136425525, 141810744, 147195961],
      []
    ]
  },
    // 真仙期
  {
    tier: 8,
    levels: [
       [43853989, 55548385, 64319182, 78937179, 87707976, 102325973, 111096770, 122791166, 134485564, 146179961, 154950758, 163721555, 175415953, 181263151, 192957548, 204651945, 210499143, 222193540, 230964337, 239735135],
       [57847086, 73272975, 84842392, 104124754, 115694171, 134976533, 146545951, 161971839, 177397729, 192823619, 204393035, 215962453, 231388342, 239101287, 254527177, 269953066, 277666011, 293091900, 304661317, 316230734],
       [78231251, 99092916, 114739167, 140816251, 156462500, 182539583, 198185834, 219047500, 239909167, 260770834, 276417084, 292063334, 312925000, 323355834, 344217501, 365079167, 375510001, 396371667, 412017917, 427664167],
       []
    ]
  },
    // 金仙期
  {
    tier: 9,
    levels: [
      [126409270, 160118408, 185400262, 227536685, 252818538, 294954962, 320236816, 353945954, 387655093, 421364232, 446646085, 471927939, 505637078, 522491646, 556200786, 589909924, 606764493, 640473632, 665755485, 691037339],
      [147741734, 187139530, 216687876, 265935121, 216687876, 265935121, 295483467, 344730713, 413676855, 453074650, 492472446, 522020793, 551569139, 590966936, 610665833, 650063628, 709160322, 748558118, 778106464, 807654811],
      [192195528, 243447668, 281886773, 345951950, 384391054, 448456231, 486895336, 538147477, 589399617, 640651758, 679090863, 717529969, 768782109, 794408180, 845660321, 896912461, 922538531, 973790672, 1012229778, 1050668882],
      []
    ]
  },
  // 太乙期
  {
    tier: 10,
    levels: [
      [297903068, 377343885, 436924499, 536225522, 595806134, 695107158, 754687771, 834128588, 913569407, 993010225, 1052590838, 1112171452, 1191612270, 1231332678, 1310773497, 1390214315, 1429934723, 1509375542, 1568956155, 1628536768],
      [387273988, 490547051, 568001849, 697093177, 774547976, 903639304, 981094102, 1084367166, 1187640228, 1290913293, 1368368089, 1445822888, 1549095950, 1600732482, 1704005546, 1807278609, 1858915141, 1962188204, 2039643001, 2117097799],
      [522819884, 662238519, 766802495, 941075790, 1045639767, 1219913061, 1324477038, 1463895673, 1603314309, 1742732945, 1847296921, 1951860897, 2091279534, 2160988851, 2300407487, 2439826122, 2509535440, 2648954075, 2753518053, 2858082028],
      []
    ]
  },
];

// 納靈石系統配置
const STONE_SYSTEM = {
  types: [
    { id: 0, name: "無", color: "black", effectValue: 0 },
    { id: 1, name: "下", color: "grey", effectValue: 10 },
    { id: 2, name: "中", color: "lightgreen", effectValue: 13 },
    { id: 3, name: "上", color: "lightblue", effectValue: 16 },
    { id: 4, name: "極", color: "magenta", effectValue: 20 },
    { id: 5, name: "仙", color: "gold", effectValue: 24 },
    { id: 6, name: "超越仙", color: "red", effectValue: 28 }
  ],
  getStone(name) {
    return this.types.find(stone => stone.name === name);
  },
  getEffectValues() {
    return this.types.map(stone => stone.effectValue);
  }
};

// 增益效果系統
const BUFF_SYSTEM = {
  types: [
    { id: 0, name: "圓滿", color: "lightBlue" },
    { id: 1, name: "大成", color: "magenta" },
    { id: 2, name: "完美", color: "gold" },
    { id: 3, name: "半步", color: "red" },
    { id: 4, name: "準", color: "#ff0088" }
  ],
  getBuff(name) {
    return this.types.find(buff => buff.name === name);
  }
};

// 修煉資源配置
const CULTIVATION_RESOURCES = {
  // 吐納數值
  breatheTechniques: [70, 565, 2606, 5837, 8400, 10500, 13407, 24877, 46378, 93300, 159000],
  
  // 紅果獎勵
  redFruitRewards: [0, 65000, 65000, 195000, 288000, 390000, 720000, 1260000, 2400000, 5430000, 10800000],
  
  // 吸收率列表
  efficiencyLevels: [
    [6.7, 8.3, 10, 10],
    [12.5, 15, 17.5, 17.5],
    [20.8, 24.2, 27.5, 27.5],
    [31.7, 35.8, 40, 40],
    [50, 60, 80, 80],
    [85, 90, 95, 95],
    [130, 160, 180, 180],
    [200, 220, 240, 240],
    [260, 280, 300, 300],
    [400, 420, 440, 440],
    [480, 520, 540, 540]
  ]
};

// 圖表系統配置
const CHART_SYSTEM = [
  { id: "base", name: "修煉速度", color: "lightgrey" },
  { id: "extra", name: "額外吸收率", color: "lightgreen" },
  { id: "breathe", name: "吐吶", color: "orange" },
  { id: "med", name: "丹藥", color: "magenta" },
  { id: "table", name: "化靈臺", color: "lightblue" },
  { id: "stone", name: "納靈石", color: "gold" },
  { id: "god", name: "至寶", color: "red" }
];

// 丹藥系統配置
const DIVINE_MEDICINE = {
  regentLevels: [1, 1.3, 1.6, 2, 2.4, 3],
  buffEffects: [
    [0, 10, 10, 20, 20],
    [0, 5, 5, 10, 10, 10]
  ]
};

// 化靈臺配置
const REFINEMENT_TABLE = {
  successChances: [16.6, 37.5, 100]
};

// 導出結構化數據
export const GameData = {
  constants: GAME_CONSTANTS,
  tiers: CULTIVATION_TIERS,
  levels: CULTIVATION_LEVELS,
  processes: CULTIVATION_PROCESSES,
  experience: EXPERIENCE_DATA,
  stones: STONE_SYSTEM,
  buffs: BUFF_SYSTEM,
  resources: CULTIVATION_RESOURCES,
  charts: CHART_SYSTEM,
  divineMedicine: DIVINE_MEDICINE,
  refinementTable: REFINEMENT_TABLE,

  // 工具方法
  getTierExperience(tierId) {
    return this.experience.find(exp => exp.tier === tierId)?.levels || GAME_CONSTANTS.EMPTY_TIER;
  },
  getMaxExperience(tierId, levelId) {
    const tierExp = this.getTierExperience(tierId);
    const levelExp = tierExp[levelId] || [];
    return levelExp.length > 0 ? Math.max(...levelExp) : GAME_CONSTANTS.EMPTY_VALUE;
  }
};

// 兼容舊版導出
export const tierList = CULTIVATION_TIERS.map(t => t.name);
export const levelList = CULTIVATION_LEVELS.slice(0, 3).map(l => l.name); // 只導出前三個階段
export const processList = CULTIVATION_PROCESSES.map(p => p.name);
export const exps = EXPERIENCE_DATA.map(t => t.levels);
export const stone = Object.fromEntries(STONE_SYSTEM.types.map(s => [s.name, s.color]));
export const buffs = Object.fromEntries(BUFF_SYSTEM.types.map(b => [b.name, b.color]));
export const stoneEff = STONE_SYSTEM.getEffectValues();
export const breatheList = [...CULTIVATION_RESOURCES.breatheTechniques, 0, 0];
export const redFruitList = [...CULTIVATION_RESOURCES.redFruitRewards, 0, 0];
export const effList = [...CULTIVATION_RESOURCES.efficiencyLevels, [0, 0, 0, 0], [0, 0, 0, 0]];
export const chartLs = CHART_SYSTEM.map(c => [c.id, c.name, c.color]);
export const godRegent = DIVINE_MEDICINE.regentLevels;
export const godBuff = DIVINE_MEDICINE.buffEffects;
export const tableChances = REFINEMENT_TABLE.successChances;
